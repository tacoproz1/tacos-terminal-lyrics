"""
Font definitions for LRC visualizer
Each font is a dictionary mapping characters to list of strings (lines)
"""
import json
from pathlib import Path
from typing import Dict, List


BLOCK_LETTERS = {
    'A': ["  ███  ", " ██ ██ ", "███████", "██   ██", "██   ██"],
    'B': ["██████ ", "██   ██", "██████ ", "██   ██", "██████ "],
    'C': [" █████ ", "██   ██", "██     ", "██   ██", " █████ "],
    'D': ["██████ ", "██   ██", "██   ██", "██   ██", "██████ "],
    'E': ["███████", "██     ", "█████  ", "██     ", "███████"],
    'F': ["███████", "██     ", "█████  ", "██     ", "██     "],
    'G': [" █████ ", "██     ", "██  ███", "██   ██", " █████ "],
    'H': ["██   ██", "██   ██", "███████", "██   ██", "██   ██"],
    'I': ["███", " ██", " ██", " ██", "███"],
    'J': ["     ██", "     ██", "     ██", "██   ██", " █████ "],
    'K': ["██   ██", "██  ██ ", "█████  ", "██  ██ ", "██   ██"],
    'L': ["██     ", "██     ", "██     ", "██     ", "███████"],
    'M': ["██   ██", "███ ███", "███████", "██ █ ██", "██   ██"],
    'N': ["██   ██", "███  ██", "████ ██", "██ ████", "██   ██"],
    'O': [" █████ ", "██   ██", "██   ██", "██   ██", " █████ "],
    'P': ["██████ ", "██   ██", "██████ ", "██     ", "██     "],
    'Q': [" █████ ", "██   ██", "██   ██", "██  ███", " ██████"],
    'R': ["██████ ", "██   ██", "██████ ", "██  ██ ", "██   ██"],
    'S': [" █████ ", "██     ", " █████ ", "     ██", " █████ "],
    'T': ["███████", "  ██   ", "  ██   ", "  ██   ", "  ██   "],
    'U': ["██   ██", "██   ██", "██   ██", "██   ██", " █████ "],
    'V': ["██   ██", "██   ██", "██   ██", " ██ ██ ", "  ███  "],
    'W': ["██   ██", "██   ██", "██ █ ██", "███████", "███ ███"],
    'X': ["██   ██", " ██ ██ ", "  ███  ", " ██ ██ ", "██   ██"],
    'Y': ["██   ██", " ██ ██ ", "  ███  ", "  ██   ", "  ██   "],
    'Z': ["███████", "    ██ ", "  ███  ", " ██    ", "███████"],
    ' ': ["    ", "    ", "    ", "    ", "    "],
    '0': [" █████ ", "██   ██", "██   ██", "██   ██", " █████ "],
    '1': ["  ██   ", " ███   ", "  ██   ", "  ██   ", "███████"],
    '2': [" █████ ", "██   ██", "   ███ ", " ██    ", "███████"],
    '3': [" █████ ", "██   ██", "  ████ ", "██   ██", " █████ "],
    '4': ["██   ██", "██   ██", "███████", "     ██", "     ██"],
    '5': ["███████", "██     ", "██████ ", "     ██", "██████ "],
    '6': [" █████ ", "██     ", "██████ ", "██   ██", " █████ "],
    '7': ["███████", "     ██", "    ██ ", "   ██  ", "  ██   "],
    '8': [" █████ ", "██   ██", " █████ ", "██   ██", " █████ "],
    '9': [" █████ ", "██   ██", " ██████", "     ██", " █████ "],
    '[': ["███", "██ ", "██ ", "██ ", "███"],
    ']': ["███", " ██", " ██", " ██", "███"],
    "'": ["██", "██", "  ", "  ", "  "],
    ',': ["  ", "  ", "  ", "██", "█ "],
    '.': ["  ", "  ", "  ", "  ", "██"],
    '!': ["██", "██", "██", "  ", "██"],
    '?': [" ███ ", "█   █", "   █ ", "     ", "  █  "],
    '-': ["      ", "      ", "██████", "      ", "      "],
    '(': [" ██", "██ ", "██ ", "██ ", " ██"],
    ')': ["██ ", " ██", " ██", " ██", "██ "],
    ':': ["  ", "██", "  ", "██", "  "],
    ';': ["  ", "██", "  ", "██", "█ "],
    '/': ["    ██", "   ██ ", "  ██  ", " ██   ", "██    "],
    '\\': ["██    ", " ██   ", "  ██  ", "   ██ ", "    ██"],
    '"': ["██ ██", "██ ██", "     ", "     ", "     "],
    '&': [" ███  ", "█   █ ", " ███  ", "█ █ █ ", " ███ █"],
    '#': [" █ █ ", "█████", " █ █ ", "█████", " █ █ "],
    '*': ["█ █ █", " ███ ", "█████", " ███ ", "█ █ █"],
    '+': ["  ██  ", "  ██  ", "██████", "  ██  ", "  ██  "],
    '=': ["      ", "██████", "      ", "██████", "      "],
    '<': ["   ██ ", "  ██  ", " ██   ", "  ██  ", "   ██ "],
    '>': [" ██   ", "  ██  ", "   ██ ", "  ██  ", " ██   "],
    '@': [" ████ ", "█    █", "█ ██ █", "█ ██ █", " ████ "],
}


COMPACT_LETTERS = {
    'A': ["▄▀▄", "█▀█", "▀ ▀"],
    'B': ["█▀▄", "█▀▄", "▀▀ "],
    'C': ["▄▀▀", "█  ", "▀▀▀"],
    'D': ["█▀▄", "█ █", "▀▀ "],
    'E': ["█▀▀", "█▀ ", "▀▀▀"],
    'F': ["█▀▀", "█▀ ", "▀  "],
    'G': ["▄▀▀", "█ ▀", "▀▀▀"],
    'H': ["█ █", "█▀█", "▀ ▀"],
    'I': ["█", "█", "▀"],
    'J': [" █", " █", "▀ "],
    'K': ["█ █", "█▀ ", "▀ ▀"],
    'L': ["█  ", "█  ", "▀▀▀"],
    'M': ["█▄▀▄█", "█ ▀ █", "▀   ▀"],
    'N': ["█▄█", "█ █", "▀ ▀"],
    'O': ["▄▀▀▄", "█  █", "▀▀▀ "],
    'P': ["█▀▄", "█▀ ", "▀  "],
    'Q': ["▄▀▀▄", "█ ▀█", "▀▀ ▀"],
    'R': ["█▀▄", "█▀▄", "▀ ▀"],
    'S': ["▄▀▀", " ▀▄", "▀▀ "],
    'T': ["▀█▀", " █ ", " ▀ "],
    'U': ["█ █", "█ █", "▀▀▀"],
    'V': ["█ █", "█ █", " ▀ "],
    'W': ["█   █", "█ ▄ █", "▀▀▀▀▀"],
    'X': ["█ █", " ▀ ", "▀ ▀"],
    'Y': ["█ █", " ▀ ", " ▀ "],
    'Z': ["▀▀█", " █ ", "█▀▀"],
    ' ': ["   ", "   ", "   "],
}


# Font registry
FONTS = {
    'block': BLOCK_LETTERS,
    'compact': COMPACT_LETTERS,
}


def get_font(name: str = 'block') -> Dict[str, List[str]]:
    """Get font by name, defaults to block letters"""
    return FONTS.get(name, BLOCK_LETTERS)


def render_text(text: str, font_name: str = 'block') -> List[str]:
    """
    Render text using specified font.
    
    Args:
        text: Text to render
        font_name: Name of font to use
        
    Returns:
        List of strings, one per line of the rendered text
    """
    font = get_font(font_name)
    text = text.upper()
    
    # Get height from first character
    height = len(font.get('A', ['']))
    lines = ['' for _ in range(height)]
    
    for char in text:
        if char in font:
            char_lines = font[char]
            for i in range(height):
                if i < len(char_lines):
                    lines[i] += char_lines[i] + ' '
                else:
                    lines[i] += ' ' * (len(char_lines[0]) + 1)
        else:
            # Unknown character - use space
            space_width = len(font.get(' ', ['    '])[0])
            for i in range(height):
                lines[i] += ' ' * (space_width + 1)
    
    return lines


def load_fonts_from_json(json_path: Path) -> Dict[str, Dict[str, List[str]]]:
    """
    Load custom fonts from JSON file.
    
    JSON format:
    {
        "font_name": {
            "A": ["line1", "line2", ...],
            "B": ["line1", "line2", ...],
            ...
        }
    }
    """
    with open(json_path, 'r', encoding='utf-8') as f:
        return json.load(f)


def register_font(name: str, font_data: Dict[str, List[str]]):
    """Register a custom font"""
    FONTS[name] = font_data
